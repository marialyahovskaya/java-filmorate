DROP TABLE IF EXISTS USERS, FILMS, GENRES, MPA_RATINGS, LIKES, FRIENDSHIPS, FILM_GENRES CASCADE;
CREATE USER IF NOT EXISTS "SA" SALT 'b511d8a8c8b76bc4' HASH 'c42fd897715572418b086a9c4e8c877ee6b423714e1eb40c15081394baad62d1' ADMIN;
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."USERS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "EMAIL" CHARACTER VARYING(65) NOT NULL,
    "LOGIN" CHARACTER VARYING(65) NOT NULL,
    "NAME" CHARACTER VARYING(65) NOT NULL,
    "BIRTHDAY" DATE NOT NULL
);
ALTER TABLE "PUBLIC"."USERS" ADD CONSTRAINT IF NOT EXISTS "USERS_PK" PRIMARY KEY("ID");
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."FILMS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "NAME" CHARACTER VARYING(65) NOT NULL,
    "DESCRIPTION" CHARACTER VARYING(200) NOT NULL,
    "RELEASE_DATE" DATE NOT NULL,
    "DURATION" INTEGER NOT NULL,
    "MPA_RATING_ID" INTEGER NOT NULL
);
ALTER TABLE "PUBLIC"."FILMS" ADD CONSTRAINT IF NOT EXISTS "FILMS_PK" PRIMARY KEY("ID");
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."GENRES"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "NAME" CHARACTER VARYING(65) NOT NULL
);
ALTER TABLE "PUBLIC"."GENRES" ADD CONSTRAINT IF NOT EXISTS "GENRES_PK" PRIMARY KEY("ID");
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."MPA_RATINGS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "NAME" CHARACTER VARYING(65) NOT NULL
);
ALTER TABLE "PUBLIC"."MPA_RATINGS" ADD CONSTRAINT IF NOT EXISTS "MPA_RATINGS_PK" PRIMARY KEY("ID");
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."FILM_GENRES"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "FILM_ID" INTEGER NOT NULL,
    "GENRE_ID" INTEGER NOT NULL
);
ALTER TABLE "PUBLIC"."FILM_GENRES" ADD CONSTRAINT IF NOT EXISTS "FILM_GENRES_PK" PRIMARY KEY("ID");
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."FRIENDSHIPS"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "USER_ID" INTEGER NOT NULL,
    "FRIEND_ID" INTEGER NOT NULL,
    "IS_CONFIRMED" BOOLEAN DEFAULT FALSE NOT NULL
);
ALTER TABLE "PUBLIC"."FRIENDSHIPS" ADD CONSTRAINT IF NOT EXISTS "FRIENDSHIPS_PK" PRIMARY KEY("ID");
CREATE CACHED TABLE IF NOT EXISTS "PUBLIC"."LIKES"(
    "ID" INTEGER GENERATED BY DEFAULT AS IDENTITY(START WITH 1) NOT NULL,
    "FILM_ID" INTEGER NOT NULL,
    "USER_ID" INTEGER NOT NULL
);
ALTER TABLE "PUBLIC"."LIKES" ADD CONSTRAINT IF NOT EXISTS "LIKES_PK" PRIMARY KEY("ID");
ALTER TABLE "PUBLIC"."FILM_GENRES" ADD CONSTRAINT IF NOT EXISTS "FILM_GENRES_FK" FOREIGN KEY("FILM_ID") REFERENCES "PUBLIC"."FILMS"("ID") ON DELETE CASCADE NOCHECK;
ALTER TABLE "PUBLIC"."LIKES" ADD CONSTRAINT IF NOT EXISTS "LIKES_FK" FOREIGN KEY("FILM_ID") REFERENCES "PUBLIC"."FILMS"("ID") ON DELETE CASCADE NOCHECK;
ALTER TABLE "PUBLIC"."FILM_GENRES" ADD CONSTRAINT IF NOT EXISTS "FILM_GENRES_FK2" FOREIGN KEY("GENRE_ID") REFERENCES "PUBLIC"."GENRES"("ID") NOCHECK;
ALTER TABLE "PUBLIC"."LIKES" ADD CONSTRAINT IF NOT EXISTS "LIKES_FK_1" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("ID") ON DELETE CASCADE NOCHECK;
ALTER TABLE "PUBLIC"."FRIENDSHIPS" ADD CONSTRAINT IF NOT EXISTS "FRIENDSHIPS_FK" FOREIGN KEY("USER_ID") REFERENCES "PUBLIC"."USERS"("ID") ON DELETE CASCADE NOCHECK;
ALTER TABLE "PUBLIC"."FRIENDSHIPS" ADD CONSTRAINT IF NOT EXISTS "FRIENDSHIPS_FK_1" FOREIGN KEY("FRIEND_ID") REFERENCES "PUBLIC"."USERS"("ID") ON DELETE CASCADE NOCHECK;
ALTER TABLE "PUBLIC"."FILMS" ADD CONSTRAINT IF NOT EXISTS "FILMS_FK" FOREIGN KEY("MPA_RATING_ID") REFERENCES "PUBLIC"."MPA_RATINGS"("ID") NOCHECK;
INSERT INTO MPA_RATINGS(name) VALUES ('G'), ('PG'), ('PG-13'), ('R'), ('NC-17');
INSERT INTO GENRES(name) VALUES ('Комедия'), ('Драма'), ('Мультфильм'), ('Триллер'), ('Документальный'), ('Боевик');